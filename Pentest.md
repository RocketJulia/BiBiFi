# Pentest Webanwendung  

## Beschreibung Entwicklungsumgebung und Tools:     
Betriebssystem: Windows 10 Build 17134.345   
IDE: IntelliJ IDEA 2018.2.5 (Ultimate Edition) Build #IU-182.4892.20  
MySQL 8.0.13   
Java 11.0.1   
Tomcat 9.0.12   

Kali Linux  2018.4-vbox-amd64  
OWASP ZAP 2.7.0  
Burp Suite Community Edition v1.7.36  

Die zu testende Anwendung:   
https://github.com/SteSt1999/Webanwendung   
Anwendungsstand: 08.11.2018 10:00   


## Sammeln von Informationen  

Ein erster Blick auf die Anwendung verrät schon einiges über die Architektur:  

![alt text](https://github.com/TimSro/BiBiFi/blob/master/DokuFiles/JSessionID_Servlet.PNG "Softwareaufbau")  

Der Cookie JSESSIONID lässt darauf schließen, dass die Anwendung in Java geschrieben ist und oben in der URL der Teil MainServlet lässt auf einen Servlet Architektur schließen.  


Sobald ein Fehler auftritt fliegt immer ein 405er und die Fehlermeldung enthält keine weiteren Informationen.  



Erstes scannen mit dem OWASP ZAP:    
![alt text](https://github.com/TimSro/BiBiFi/blob/master/DokuFiles/ZapFindings.PNG "ZAP Findings")  

Scanner verwendet:  
nmap  
wmap  
sqlmap  





An zwei Rechnern gleichzeitig an einem Account anmelden  
* an beiden kann man geld Abheben  

Wenn die .jsp's lassen sich einzeln aufrufen, aber keine weiteren Interaktionen und keine Einsicht in die Daten, oder vielleicht doch (Siehe XSS Testing)...   
http://localhost:8080/ATM/ATMAuswahl.jsp?css=%3CSCRIPT%3Ealert(123)%3C/script%3E  

Bei der Auswahl der Bank lassen sich flasche Eingaben machen, wenn man die .jsps direkt aufruft und über die URL die Werte setzt:  
http://localhost:8080/Auswahl.jsp?BankID=falsche  


XSS Testing:  
http://localhost:8080/Auswahl.jsp?BankID=%3Cscript%3Ealert(123)%3C/script%3E  
http://localhost:8080/Auswahl.jsp?BankID=hostbank%22%3E%3Cscript%3Ealert(123)%3C/script%3E  
Springt weiter, obwohl keine Bank ausgewählt  



**----------------------------------------------------------------------------**

## Findings 

### Overview  

| Finding                      | Rating        | Description                              |
| ---------------------------- |:-------------:| ----------------------------------------:|
| Broken Session Management    | Critical      |                                          |
| CSRF                         | Medium        |                                          |
| Clickjacking                 | Low           | Can be opened in an iFrame               |
| SQL Injection                | Critical      | Database exposure through timebased SQLi |
| XSS                          | Informational | XSS Protection not enabled               |


### Details  

#### Broken Session Management  
Ein User ist eingloggt.  
In einem anderen Browser kann man nun die .jsp's direkt aufrufen und ist dann im Account aus dem anderen Browser eingeloggt.  

Es können sich immer nur ein User anmelden, wenn einer sich dann anmeldet überschreibt er die Session des ersten Users.  

#### CSRF
Es gibt keine Protection gegen Cross-Site-Scripting.
Dafür wurde ein Proof of Concept erstellt.
 


#### Clickjacking  

Die Weanwendung ist anfällig für Clickjacking, da sich diese in einem iFrame einbinden lässt.  
Dafür wurde ein PoC gebaut, als Ergebnis davon hier ein Beispiels Screenshot:  

![alt text](https://github.com/TimSro/BiBiFi/blob/master/DokuFiles/clickjacking.PNG "Clickjacking Beispiel")
 

#### SQL Injection  
Die Anwendung ist prinzipiell anfällig für SQL Injection.  

Die Eingaben werden nicht auf Steuerzeichen überprüft und es werden keine [Prepared Statements](https://docs.oracle.com/javase/tutorial/jdbc/basics/prepared.html) verwendet.  
An der Oberfläche ist die länge der Eingabe meistens auf 50 Zeichen begrenzt.  
Diese Begrenzung lässt sich aber ganz einfach, mit Hilfe der Entwicklertools des Browsers hochsetzten um gültige Querrys zu erzeugen.  
Folgende Eingabe in das Feld "Benutzername" auf der Seite "Mitarbeiter" ist zum Beispiel valide:    

`a";INSERT INTO MITARBEITER VALUES("2","2","2","2");#`

Allerdings wird diese Querry in einem Großteil der Fälle trotzdem nicht funktionieren, da der  [MySQL Connector/J ab Version 3.1.1](https://dev.mysql.com/doc/connector-j/5.1/en/connector-j-reference-configuration-properties.html) (stark veraltete legacy Version) keine Stacked Querries mehr erlaubt. SCREENSHOT

Es ist jedoch möglich einen timebased Angriff durchzuführen.  
Mit der folgenden Querry kann man zum Beispiel Passwörter enumerieren:  

```1" UNION SELECT IF(SUBSTRING(KENNWORT,1,1) = CHAR(80),BENCHMARK(10000000,sha1(1)),null) KENNWORT FROM KUNDEN WHERE ID = "stump.stefan```

Dafür muss man nur den nur den Substring und Char variieren.
Da die Passwörter in Klartext in der Datenbank liegen muss man nicht den Hash knacken, sondern hat diese direkt.

#### XSS  
Die Anwendung ist theoretisch für XSS anfällig, da keine XSS Protection enabled ist.  
Allerdings lässt sich XSS praktisch nicht ausnutzen, da es auf keiner Seite eine Eingabe gibt, welche die nächste Seite mit beeinflusst.  
Somit lässt sich dort kein Script mit rein integrieren.  

Folgender Aufruf wird zum Beispiel nicht abgefangen, hat aber auch aus dem oben beschriebenen Grund keinerlei Auswirkung auf die Anwendung:  

`http://localhost:8080/Auswahl.jsp?BankID=hostbank%22%3E%3Cscript%3Ealert(123)%3C/script%3E  `

